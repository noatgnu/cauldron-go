<div class="form-container">
  <mat-card class="form-card">
    <mat-card-header>
      <mat-card-title>Estimation Plot Analysis</mat-card-title>
      <div class="header-right">
        <app-environment-indicator></app-environment-indicator>
      </div>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="form" (ngSubmit)="submit()" class="form">
        <div class="form-section">
          <h3>Input Files</h3>

          <mat-form-field>
            <mat-label>Input File *</mat-label>
            <input matInput formControlName="inputFile" readonly placeholder="Select input file" required>
            <button mat-icon-button matSuffix (click)="openFile('inputFile')" type="button">
              <mat-icon>folder_open</mat-icon>
            </button>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Sample Annotation File *</mat-label>
            <input matInput formControlName="sampleAnnotation" readonly placeholder="Select annotation file" required>
            <button mat-icon-button matSuffix (click)="openFile('sampleAnnotation')" type="button">
              <mat-icon>folder_open</mat-icon>
            </button>
          </mat-form-field>
        </div>

        <div class="form-section">
          <h3>Parameters</h3>

          <mat-form-field>
            <mat-label>Index Column *</mat-label>
            <input matInput formControlName="indexCol" placeholder="Column name for protein/gene ID" required>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Condition Order</mat-label>
            <input matInput formControlName="conditionOrder" placeholder="Comma-separated condition names">
          </mat-form-field>

          <div class="checkbox-group">
            <mat-checkbox formControlName="log2">Apply Log2 Transformation</mat-checkbox>
          </div>
        </div>

        <div class="form-section">
          <h3>Select Proteins (up to 10)</h3>
          @if (proteins.length > 0) {
            <div class="protein-chips">
              @for (protein of proteins.slice(0, 10); track protein) {
                <mat-chip
                  [highlighted]="isProteinSelected(protein)"
                  (click)="toggleProtein(protein)"
                  class="protein-chip">
                  {{ protein }}
                </mat-chip>
              }
            </div>
          } @else {
            <p class="info-text">Load a file to see available proteins</p>
          }
        </div>

        <div class="form-actions">
          <button mat-raised-button color="primary" type="submit" [disabled]="running || form.invalid">
            @if (running) {
              <mat-spinner diameter="20"></mat-spinner>
              <span>Running...</span>
            } @else {
              <span>Run Analysis</span>
            }
          </button>
          <button mat-stroked-button type="button" (click)="reset()" [disabled]="running">Reset</button>
          <button mat-stroked-button type="button" (click)="loadExample()" [disabled]="running">Load Example</button>
          @if (createdJobId) {
            <button mat-raised-button color="accent" (click)="viewJob()">
              <mat-icon>visibility</mat-icon>
              View Job
            </button>
          }
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
