<div class="form-container">
  <mat-card class="form-card">
    <mat-card-header>
      <mat-card-title>CV Plot Analysis</mat-card-title>
      <div class="header-right">
        <app-environment-indicator></app-environment-indicator>
      </div>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="form" (ngSubmit)="submit()" class="form">
        <div class="form-section">
          <h3>Input Files</h3>

          <mat-form-field>
            <mat-label>Log File (Optional)</mat-label>
            <input matInput formControlName="logFilePath" readonly placeholder="Select log file">
            <button mat-icon-button matSuffix (click)="openFile('logFilePath')" type="button">
              <mat-icon>folder_open</mat-icon>
            </button>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Report PR File *</mat-label>
            <input matInput formControlName="reportPrFilePath" readonly placeholder="Select report PR file" required>
            <button mat-icon-button matSuffix (click)="openFile('reportPrFilePath')" type="button">
              <mat-icon>folder_open</mat-icon>
            </button>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Report PG File *</mat-label>
            <input matInput formControlName="reportPgFilePath" readonly placeholder="Select report PG file" required>
            <button mat-icon-button matSuffix (click)="openFile('reportPgFilePath')" type="button">
              <mat-icon>folder_open</mat-icon>
            </button>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Annotation File *</mat-label>
            <input matInput formControlName="annotationFile" readonly placeholder="Select annotation file" required>
            <button mat-icon-button matSuffix (click)="openFile('annotationFile')" type="button">
              <mat-icon>folder_open</mat-icon>
            </button>
          </mat-form-field>
        </div>

        <div class="form-section">
          <h3>Parameters</h3>

          <mat-form-field>
            <mat-label>Intensity Column</mat-label>
            <input matInput formControlName="intensityCol" placeholder="Default: Intensity">
          </mat-form-field>

          <mat-form-field>
            <mat-label>Sample Names (Optional)</mat-label>
            <input matInput formControlName="sampleNames" placeholder="Comma-separated sample names">
          </mat-form-field>
        </div>

        <div class="form-actions">
          <button mat-raised-button color="primary" type="submit" [disabled]="running || form.invalid">
            @if (running) {
              <mat-spinner diameter="20"></mat-spinner>
              <span>Running...</span>
            } @else {
              <span>Run Analysis</span>
            }
          </button>
          <button mat-stroked-button type="button" (click)="reset()" [disabled]="running">Reset</button>
          <button mat-stroked-button type="button" (click)="loadExample()" [disabled]="running">Load Example</button>
          @if (createdJobId) {
            <button mat-raised-button color="accent" (click)="viewJob()">
              <mat-icon>visibility</mat-icon>
              View Job
            </button>
          }
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
