<div class="form-container">
  <mat-card class="form-card">
    <mat-card-header>
      <mat-card-title>Fold Change Violin Plot Analysis</mat-card-title>
      <div class="header-right">
        <app-environment-indicator></app-environment-indicator>
      </div>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="form" (ngSubmit)="submit()" class="form">
        <div class="form-section">
          <h3>Input File</h3>

          <mat-form-field>
            <mat-label>Input File *</mat-label>
            <input matInput formControlName="inputFile" readonly placeholder="Select input file" required>
            <button mat-icon-button matSuffix (click)="openFile('inputFile')" type="button">
              <mat-icon>folder_open</mat-icon>
            </button>
          </mat-form-field>
        </div>

        <div class="form-section">
          <h3>Column Configuration</h3>

          <mat-form-field>
            <mat-label>Columns Prefix</mat-label>
            <input matInput formControlName="columnsPrefix" placeholder="Default: Difference">
          </mat-form-field>

          <mat-form-field>
            <mat-label>Fold Enrichment Column</mat-label>
            <input matInput formControlName="foldEnrichmentCol" placeholder="Default: Fold enrichment">
          </mat-form-field>

          <mat-form-field>
            <mat-label>Organelle Column</mat-label>
            <input matInput formControlName="organelleCol" placeholder="Default: Organelle">
          </mat-form-field>

          <mat-form-field>
            <mat-label>Comparison Column (Optional)</mat-label>
            <input matInput formControlName="comparisonCol" placeholder="Optional column for grouping">
          </mat-form-field>
        </div>

        <div class="form-section">
          <h3>Data Parameters</h3>

          <mat-form-field>
            <mat-label>Categories *</mat-label>
            <input matInput formControlName="categories" placeholder="Comma-separated category names" required>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Match Value</mat-label>
            <input matInput formControlName="matchValue" placeholder="Default: +">
          </mat-form-field>
        </div>

        <div class="form-section">
          <h3>Display Options</h3>

          <mat-form-field>
            <mat-label>Figure Size</mat-label>
            <input matInput formControlName="figsize" placeholder="Format: width,height (Default: 6,10)">
          </mat-form-field>

          <mat-form-field>
            <mat-label>Colors (Optional)</mat-label>
            <textarea matInput formControlName="colors" placeholder="Format: category:color,category:color&#10;Example: C..Lysosome:#ffb3ba,ER:#bae1ff" rows="3"></textarea>
          </mat-form-field>
        </div>

        <div class="form-actions">
          <button mat-raised-button color="primary" type="submit" [disabled]="running || form.invalid">
            @if (running) {
              <mat-spinner diameter="20"></mat-spinner>
              <span>Running...</span>
            } @else {
              <span>Run Analysis</span>
            }
          </button>
          <button mat-stroked-button type="button" (click)="reset()" [disabled]="running">Reset</button>
          @if (createdJobId) {
            <button mat-raised-button color="accent" (click)="viewJob()">
              <mat-icon>visibility</mat-icon>
              View Job
            </button>
          }
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
