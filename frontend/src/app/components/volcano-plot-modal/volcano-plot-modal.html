<h2 mat-dialog-title>Volcano Plot</h2>

<mat-dialog-content>
  <div class="volcano-viewer">
    <div class="plot-container">
      @if (assembling) {
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
        <p>Loading data...</p>
      } @else {
        @if (form.value.comparison && df && df.count() > 0) {
          <app-volcano-plot
            [title]="form.value.comparison"
            [data]="df"
            [revision]="revision"
            [pValueCutoff]="pValueCutoffTransformed"
            [log2FoldChangeCutoff]="form.value.log2FoldChangeCutoff">
          </app-volcano-plot>
        }
      }
    </div>

    <div class="controls-panel">
      <form [formGroup]="form" class="controls-form">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Primary ID Columns</mat-label>
          <mat-select formControlName="indexCols" multiple>
            @for (col of _indexCols; track col) {
              <mat-option [value]="col">{{col}}</mat-option>
            }
          </mat-select>
        </mat-form-field>

        @if (comparisons.length > 0) {
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Comparison</mat-label>
            <mat-select formControlName="comparison">
              @for (comp of comparisons; track comp) {
                <mat-option [value]="comp">{{comp}}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        }
      </form>
    </div>
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="close()">Close</button>
</mat-dialog-actions>
